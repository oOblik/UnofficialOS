#!/bin/bash
# SPDX-License-Identifier: Apache-2.0
# Copyright (C) 2021-present Fewtarius (https://github.com/fewtarius)

. /etc/profile

### Variables may need to be device specific here.
BRIGHTNESS=$(get_setting system.brightness)
if [[ ! "${BRIGHTNESS}" =~ [0-9] ]]
then
  BRIGHTNESS=${DEVICE_BRIGHTNESS}
fi

# Ensure user doesn't get "locked out" with super low brightness
if [[ "${BRIGHTNESS}" -lt "3" ]]
then
  BRIGHTNESS=3
fi

BRIGHTNESS_DEVICE="$(brightness device)"
if [ -e "/sys/class/backlight/${BRIGHTNESS_DEVICE}/brightness" ]
then
  printf "%.0f" $(echo "${BRIGHTNESS}") > /sys/class/backlight/${BRIGHTNESS_DEVICE}/brightness
fi

# Configure default contrast saturation and hue values
for PROPERTY in brightness contrast saturation hue
do
  MYVAL=$(get_setting display.${PROPERTY})
  if [ -z "${MYVAL}" ]
  then
    MYVAL=$(drm_tool list | sed -n '/Connector: 133/,$p' | awk '/'${PROPERTY}'/ {print $5}')
  fi
  display ${PROPERTY} ${MYVAL}
done
